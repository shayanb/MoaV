# MoaV - Multi-protocol Circumvention Stack
# Copy to .env and fill in your values

# =============================================================================
# REQUIRED CONFIGURATION
# =============================================================================

# Your domain (must have DNS configured - see docs/DNS.md)
# Leave empty to run only domain-less services (WireGuard, Conduit, Snowflake)
DOMAIN=

# Email for Let's Encrypt certificates (required if DOMAIN is set)
ACME_EMAIL=

# Admin password for stats dashboard (https://your-domain:9443)
ADMIN_PASSWORD=change_me_to_something_secure

# =============================================================================
# SERVER IDENTITY
# =============================================================================

# Server's public IP (auto-detected if empty, but set manually for reliability)
SERVER_IP=

# Server's public IPv6 (auto-detected if available)
# Set to "disabled" to explicitly disable IPv6 even if available
SERVER_IPV6=

# =============================================================================
# PROTOCOL TOGGLES
# =============================================================================

# Enable/disable individual protocols
ENABLE_REALITY=true
ENABLE_TROJAN=true
ENABLE_HYSTERIA2=true
ENABLE_WIREGUARD=true
ENABLE_DNSTT=true
ENABLE_TRUSTTUNNEL=true
ENABLE_ADMIN_UI=true
ENABLE_CONDUIT=true
ENABLE_SNOWFLAKE=true
ENABLE_MONITORING=true

# =============================================================================
# COMPONENT VERSIONS
# =============================================================================

# sing-box - https://github.com/SagerNet/sing-box/releases
SINGBOX_VERSION=1.12.21

# wstunnel - https://github.com/erebe/wstunnel/releases
WSTUNNEL_VERSION=10.5.2

# Psiphon Conduit - https://github.com/Psiphon-Inc/conduit/releases
CONDUIT_VERSION=1.5.0

# Tor Snowflake - https://gitlab.torproject.org/tpo/anti-censorship/pluggable-transports/snowflake/-/releases
SNOWFLAKE_VERSION=2.11.0

# TrustTunnel endpoint - https://github.com/TrustTunnel/TrustTunnel/releases
TRUSTTUNNEL_VERSION=0.9.125

# TrustTunnel client - https://github.com/TrustTunnel/TrustTunnelClient/releases
TRUSTTUNNEL_CLIENT_VERSION=0.99.105

# =============================================================================
# HYSTERIA2 CONFIGURATION (QUIC-based, fast but may be blocked)
# =============================================================================

# Obfuscation password for Hysteria2 (helps bypass QUIC blocking)
# Auto-generated if empty. REQUIRED for censored regions like Iran/China
HYSTERIA2_OBFS_PASSWORD=

# =============================================================================
# REALITY CONFIGURATION (Primary Protocol)
# =============================================================================

# Reality target site - must support TLS 1.3 + H2
# IMPORTANT: For censored regions, avoid well-known targets like microsoft.com
REALITY_TARGET=dl.google.com:443

# Reality short ID (8 hex chars) - auto-generated if empty
REALITY_SHORT_ID=

# Reality private key - auto-generated if empty
REALITY_PRIVATE_KEY=

# =============================================================================
# DNSTT CONFIGURATION (DNS Tunnel - Last Resort)
# =============================================================================

# Subdomain for DNS tunnel (NS record must point to this server)
# Full tunnel domain: ${DNSTT_SUBDOMAIN}.${DOMAIN} (e.g., t.example.com)
DNSTT_SUBDOMAIN=t

# =============================================================================
# BANDWIDTH DONATION (Help Others Bypass Censorship)
# =============================================================================

# Psiphon Conduit - donate bandwidth to help Psiphon users
CONDUIT_BANDWIDTH=200        # Mbps limit
CONDUIT_MAX_CLIENTS=100      # Max concurrent clients
CONDUIT_STATS_ENABLED=false  # GeoIP stats (uses extra CPU)

# Tor Snowflake - donate bandwidth to help Tor users
SNOWFLAKE_BANDWIDTH=50       # Mbps limit
SNOWFLAKE_CAPACITY=20        # Max concurrent clients

# =============================================================================
# PORTS
# =============================================================================

PORT_HTTPS=443       # Reality (VLESS) + Hysteria2 (UDP)
PORT_TROJAN=8443     # Trojan fallback
PORT_WIREGUARD=51820 # WireGuard (UDP)
PORT_WSTUNNEL=8080   # WebSocket tunnel for WireGuard
PORT_DNS=53          # DNS tunnel (dnstt)
PORT_ADMIN=9443      # Admin dashboard
PORT_CDN=2082        # CDN WebSocket (VLESS+WS)
PORT_TRUSTTUNNEL=4443 # TrustTunnel (HTTP/2 + QUIC)
PORT_GRAFANA=9444    # Grafana monitoring dashboard

# =============================================================================
# MONITORING CONFIGURATION
# =============================================================================

# Clash API secret for sing-box metrics exporter
# Auto-generated by bootstrap, copy from configs/sing-box/config.json if needed
# Look for: "clash_api": { "secret": "YOUR_SECRET" }
CLASH_API_SECRET=

# Grafana root URL (optional, for Cloudflare CDN routing)
# If using grafana subdomain via Cloudflare, set this to enable faster loading:
# GRAFANA_ROOT_URL=https://grafana.yourdomain.xyz:2083
GRAFANA_ROOT_URL=

# =============================================================================
# CDN CONFIGURATION (Cloudflare CDN-fronted VLESS+WebSocket)
# =============================================================================

# CDN domain (Cloudflare-proxied). Leave empty to disable CDN links.
CDN_DOMAIN=

# WebSocket path for CDN inbound
CDN_WS_PATH=/ws

# =============================================================================
# OPTIONAL CONFIGURATION
# =============================================================================

# Default profiles for 'moav start' (space-separated)
# Options: proxy wireguard dnstt trusttunnel admin conduit snowflake
# Use 'all' for everything, or leave empty to be prompted
DEFAULT_PROFILES=proxy

# Number of initial users to create during bootstrap
# Set to 1 to create 'demouser', or higher for user01, user02, etc.
INITIAL_USERS=1

# Timezone for logs
TZ=UTC

# Log level: debug, info, warn, error
LOG_LEVEL=info

# Admin UI IP whitelist (comma-separated CIDR, empty = password only)
# Example: ADMIN_IP_WHITELIST=192.168.1.0/24,10.0.0.5
ADMIN_IP_WHITELIST=

# =============================================================================
# CLIENT MODE (for 'moav client' command)
# =============================================================================

# Local proxy ports when running in client mode
# Uses non-standard ports to avoid conflicts with server services
CLIENT_SOCKS_PORT=10800
CLIENT_HTTP_PORT=18080

# =============================================================================
# INTERNAL (do not modify)
# =============================================================================

COMPOSE_PROJECT_NAME=moav
